!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("echarts")):"function"==typeof define&&define.amd?define(["echarts"],t):"object"==typeof exports?exports["echarts-graph-modularity"]=t(require("echarts")):e["echarts-graph-modularity"]=t(e.echarts)}(this,function(e){return function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){var o=r(2),n=r(3);n.registerVisual(n.PRIORITY.VISUAL.CHART+1,function(e,t){var r={};e.eachSeriesByType("graph",function(e){var t=e.get("modularity");if(t){var n=e.getGraph(),a={},s=n.data.mapArray(function(e){var t=n.getNodeByIndex(e);return a[t.id]=e,t.id}),c=n.edgeData.mapArray("value",function(e,t){var r=n.getEdgeByIndex(t);return{source:r.node1.id,target:r.node2.id,value:e}}),i=o().nodes(s).edges(c).partition_init(),u=i();for(var f in u){var d=u[f];n.data.setItemVisual(a[f],"color",e.getColorFromPalette(d,r))}n.edgeData.each(function(e){var t=n.edgeData.getItemModel(e),r=n.getEdgeByIndex(e),o=t.get("lineStyle.normal.color");switch(o){case"source":o=r.node1.getVisual("color");break;case"target":o=r.node2.getVisual("color")}null!=o&&r.setVisual("color",o)})}})})},function(e,t){jLouvain=function(){function e(e){var t={};return e.forEach(function(e,r){t[e]=!0}),Object.keys(t)}function t(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function r(e,t){var r=e._assoc_mat[t]?Object.keys(e._assoc_mat[t]):[],o=0;return r.forEach(function(r,n){var a=e._assoc_mat[t][r]||1;t===r&&(a*=2),o+=a}),o}function o(e,t){if("undefined"==typeof e._assoc_mat[t])return[];var r=Object.keys(e._assoc_mat[t]);return r}function n(e,t,r){return e._assoc_mat[t]?e._assoc_mat[t][r]:void 0}function a(e){var t=0;return e.edges.forEach(function(e){t+=e.weight}),t}function s(e,t){i(e,t);var r=e.edges.map(function(e){return e.source+"_"+e.target}).indexOf(t.source+"_"+t.target);-1!==r?e.edges[r].weight=t.weight:e.edges.push(t)}function c(e){var t={};return e.forEach(function(e,r){t[e.source]=t[e.source]||{},t[e.source][e.target]=e.weight,t[e.target]=t[e.target]||{},t[e.target][e.source]=e.weight}),t}function i(e,t){e._assoc_mat[t.source]=e._assoc_mat[t.source]||{},e._assoc_mat[t.source][t.target]=t.weight,e._assoc_mat[t.target]=e._assoc_mat[t.target]||{},e._assoc_mat[t.target][t.source]=t.weight}function u(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var r in e)t[r]=u(e[r]);return t}function f(e,t,s){t.nodes_to_com={},t.total_weight=0,t.internals={},t.degrees={},t.gdegrees={},t.loops={},t.total_weight=a(e),"undefined"==typeof s?e.nodes.forEach(function(o,a){t.nodes_to_com[o]=a;var s=r(e,o);if(0>s)throw"Bad graph type, use positive weights!";t.degrees[a]=s,t.gdegrees[o]=s,t.loops[o]=n(e,o,o)||0,t.internals[a]=t.loops[o]}):e.nodes.forEach(function(n,a){var c=s[n];t.nodes_to_com[n]=c;var i=r(e,n);t.degrees[c]=(t.degrees[c]||0)+i,t.gdegrees[n]=i;var u=0,f=o(e,n);f.forEach(function(t,r){var o=e._assoc_mat[n][t];if(0>=o)throw"Bad graph type, use positive weights";s[t]===c&&(u+=t===n?o:o/2)}),t.internals[c]=(t.internals[c]||0)+u})}function d(r){var o=r.total_weight,n=0,a=e(t(r.nodes_to_com));return a.forEach(function(e,t){var a=r.internals[e]||0,s=r.degrees[e]||0;o>0&&(n=n+a/o-Math.pow(s/(2*o),2))}),n}function g(e,t,r){var n={},a=o(t,e);return a.forEach(function(o,a){if(o!==e){var s=t._assoc_mat[e][o]||1,c=r.nodes_to_com[o];n[c]=(n[c]||0)+s}}),n}function h(e,t,r,o){o.nodes_to_com[e]=+t,o.degrees[t]=(o.degrees[t]||0)+(o.gdegrees[e]||0),o.internals[t]=(o.internals[t]||0)+r+(o.loops[e]||0)}function _(e,t,r,o){o.degrees[t]=(o.degrees[t]||0)-(o.gdegrees[e]||0),o.internals[t]=(o.internals[t]||0)-r-(o.loops[e]||0),o.nodes_to_com[e]=-1}function v(e){var t=0,r=u(e),o={},n=Object.keys(e);return n.forEach(function(n){var a=e[n],s="undefined"==typeof o[a]?-1:o[a];-1===s&&(o[a]=t,s=t,t+=1),r[n]=s}),r}function l(e,t){for(var r=!0,o=0,n=d(t),a=n;r&&o!==b&&(n=a,r=!1,o+=1,e.nodes.forEach(function(o,n){var a=t.nodes_to_com[o],s=(t.gdegrees[o]||0)/(2*t.total_weight),c=g(o,e,t);_(o,a,c[a]||0,t);var i=a,u=0,f=Object.keys(c);f.forEach(function(e,r){var o=c[e]-(t.degrees[e]||0)*s;o>u&&(u=o,i=e)}),h(o,i,c[i]||0,t),i!==a&&(r=!0)}),a=d(t),!(j>a-n)););}function p(r,o){var a,c,i={nodes:[],edges:[],_assoc_mat:{}},u=t(r);return i.nodes=i.nodes.concat(e(u)),o.edges.forEach(function(e,t){c=e.weight||1;var o=r[e.source],u=r[e.target];a=n(i,o,u)||0;var f=a+c;s(i,{source:o,target:u,weight:f})}),i}function m(e,t){for(var r=u(e[0]),o=1;t+1>o;o++)Object.keys(r).forEach(function(t,n){var a=t,s=r[t];r[a]=e[o][s]});return r}function y(e,t){if(0===e.edges.length){var r={};return e.nodes.forEach(function(e,t){r[e]=e}),r}var o={};f(O,o,t);var n=d(o),a=[];l(O,o);var s=d(o),c=v(o.nodes_to_com);a.push(c),n=s;var i=p(c,O);for(f(i,o);;){if(l(i,o),s=d(o),j>s-n)break;c=v(o.nodes_to_com),a.push(c),n=s,i=p(c,i),f(i,o)}return a}var w,E,x,b=-1,j=1e-7,O={},k=function(){var e=y(O,x);return m(e,e.length-1)};return k.nodes=function(e){return arguments.length>0&&(w=e),k},k.edges=function(e){if("undefined"==typeof w)throw"Please provide the graph nodes first!";if(arguments.length>0){E=e;var t=c(e);O={nodes:w,edges:E,_assoc_mat:t}}return k},k.partition_init=function(e){return arguments.length>0&&(x=e),k},k},e.exports=jLouvain},function(t,r){t.exports=e}])});